<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>佛學大富翁計分表</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.0.0-alpha/dist/tailwind.min.css" rel="stylesheet">
  <style>
    @keyframes countUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    body {
      font-family: 'Noto Sans TC', sans-serif;
      min-height: 100vh;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
      padding: 20px;
    }

    .status-button {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.95);
      padding: 12px;
      z-index: 1000;
      cursor: pointer;
      transition: all 0.3s ease;
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(10px);
    }

    .status-button:hover {
      background: rgba(255, 255, 255, 1);
      transform: translateY(2px);
    }

    .status-card {
      position: fixed;
      top: -100%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 500px;
      background-image: url('background.jpg');
      background-size: cover;
      background-position: center;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transition: top 0.3s ease-in-out;
      z-index: 1000;
      padding: 1.5rem;
    }

    #statusCard.expanded {
      top: 1rem;
    }

    /* 為了確保文字清晰可見，添加半透明的遮罩 */
    #statusCard::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 12px;
      z-index: -1;
    }

    /* 調整狀態文字的樣式，確保在背景圖上清晰可見 */
    #statusCard .status-item {
      position: relative;
      z-index: 1;
      margin: 0.5rem 0;
    }

    .mini-stats {
      display: flex;
      justify-content: center;
      gap: 2rem;
    }

    .mini-stat-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-weight: 600;
      font-size: 1.1rem;
      color: #2d3748;
      padding: 4px 12px;
      background: rgba(66, 153, 225, 0.1);
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .mini-stat-item:hover {
      background: rgba(66, 153, 225, 0.2);
      transform: translateY(-2px);
    }

    .amitabha-mini {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1)) !important;
      border: 1px solid rgba(255, 215, 0, 0.3);
    }

    .animated-number {
      animation: countUp 0.5s ease-out forwards;
    }

    .status-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      position: relative;
      z-index: 1;
    }

    .status-item {
      padding: 1rem;
      text-align: center;
      background: rgba(66, 153, 225, 0.1);
      border-radius: 8px;
      border: 1px solid rgba(66, 153, 225, 0.2);
    }

    .status-label {
      font-size: 0.9rem;
      color: #4a5568;
      margin-bottom: 0.5rem;
    }

    .status-value {
      font-size: 1.5rem;
      font-weight: bold;
      color: #2d3748;
    }

    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      padding: 24px;
      transition: all 0.4s ease;
      height: 100%;
      display: flex;
      flex-direction: column;
      max-width: 100%;
      box-sizing: border-box;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 36px rgba(31, 38, 135, 0.2);
    }

    .card-header {
      border-bottom: 2px solid #f0f0f0;
      padding-bottom: 1rem;
      margin-bottom: 1.5rem;
    }

    .card-header h3 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2d3748;
      margin: 0;
    }

    .card-content {
      flex: 1;
      padding-right: 4px;
    }

    .input-group {
      margin-bottom: 1.5rem;
      max-width: 100%;
    }

    label {
      color: #4a5568;
      font-weight: 500;
      margin-bottom: 0.5rem;
      display: block;
    }

    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.9);
      box-sizing: border-box;
      max-width: 100%;
    }

    input:focus, select:focus {
      border-color: #4299e1;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
      outline: none;
    }

    button {
      width: 100%;
      padding: 16px 24px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 18px;
      transition: all 0.3s ease;
      margin-bottom: 1rem;
      border: none;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0) 100%);
      transform: translateX(-100%);
      transition: transform 0.6s;
    }

    button:hover::before {
      transform: translateX(100%);
    }

    #submitEvent {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
    }

    #submitEvent:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(76, 175, 80, 0.4);
    }

    #collapseClub {
      background: linear-gradient(135deg, #f44336, #e53935);
      color: white;
      box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
    }

    #resetClub {
      background: linear-gradient(135deg, #3498db, #2980b9);
      color: white;
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
    }

    .button-container {
      margin-top: auto;
      padding-top: 1rem;
    }

    .collapsed {
      opacity: 0.7;
      pointer-events: none;
      filter: grayscale(0.5);
    }

    #alertDialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
    }

    .alert-content {
      background: white;
      padding: 2rem;
      border-radius: 16px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
    }

    #eventHistory > div {
      background: rgba(255, 255, 255, 0.9);
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      animation: fadeIn 0.5s ease-out;
    }

    .event-type-buttons {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .event-type-btn {
      flex: 1;
      padding: 0.75rem;
      border-radius: 8px;
      font-weight: 600;
      transition: background-color 0.3s ease;
    }

    .event-type-btn:hover {
      background-color: rgba(66, 153, 225, 0.2);
    }

    .event-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }

    .event-option {
      padding: 0.75rem;
      border-radius: 8px;
      font-weight: 500;
      background: rgba(66, 153, 225, 0.1);
      border: 1px solid rgba(66, 153, 225, 0.2);
      transition: background-color 0.3s ease;
    }

    .event-option:hover {
      background-color: rgba(66, 153, 225, 0.2);
    }

    .hidden {
      display: none;
    }

    .amitabha-status {
      text-align: center;
      padding: 1rem;
      background: rgba(255, 223, 186, 0.2);
      border-radius: 8px;
      margin: 1rem 0;
    }

    .special-event {
      background: linear-gradient(135deg, #FFD700, #FFA500) !important;
      color: #fff;
      font-weight: bold;
      border: none !important;
    }

    .special-event:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
    }

    #challenges {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 1rem;
      background: rgba(255, 255, 255, 0.9);
      margin-bottom: 1rem;
    }

    #challenges:focus {
      border-color: #4299e1;
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
      outline: none;
    }

    .submit-button {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .submit-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .submit-button:active {
      transform: translateY(0);
    }

    .event-option[data-event="布施攝"],
    .event-option[data-event="愛語攝"],
    .event-option[data-event="利行攝"],
    .event-option[data-event="同事攝"] {
      color: white;
      font-weight: 700;  /* 加粗字體 */
      border: none !important;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      position: relative;
      overflow: hidden;
      padding: 12px 20px;  /* 增加內邊距 */
      letter-spacing: 0.5px;  /* 字間距 */
      border-radius: 12px;  /* 更圓潤的邊角 */
      backdrop-filter: blur(5px);
    }

    /* 布施攝 - 高貴金色主題 */
    .event-option[data-event="布施攝"] {
      background: linear-gradient(135deg, #FFD700, #FFA500, #FF8C00) !important;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    /* 愛語攝 - 溫柔粉紅主題 */
    .event-option[data-event="愛語攝"] {
      background: linear-gradient(135deg, #FF69B4, #FF1493, #C71585) !important;
      box-shadow: 0 4px 15px rgba(255, 105, 180, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    /* 利行攝 - 生機翡翠主題 */
    .event-option[data-event="利行攝"] {
      background: linear-gradient(135deg, #00FA9A, #00CED1, #008B8B) !important;
      box-shadow: 0 4px 15px rgba(0, 250, 154, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    /* 同事攝 - 高雅紫色主題 */
    .event-option[data-event="同事攝"] {
      background: linear-gradient(135deg, #9370DB, #8A2BE2, #4B0082) !important;
      box-shadow: 0 4px 15px rgba(147, 112, 219, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    /* 閃光效果增強 */
    .event-option[data-event="布施攝"]::before,
    .event-option[data-event="愛語攝"]::before,
    .event-option[data-event="利行攝"]::before,
    .event-option[data-event="同事攝"]::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
      );
      transform: rotate(45deg);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      opacity: 0;
      z-index: 1;
    }

    /* 內部光暈效果 */
    .event-option[data-event="布施攝"]::after,
    .event-option[data-event="愛語攝"]::after,
    .event-option[data-event="利行攝"]::after,
    .event-option[data-event="同事攝"]::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, 
        rgba(255, 255, 255, 0.2) 0%,
        transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    /* 懸浮效果增強 */
    .event-option[data-event="布施攝"]:hover,
    .event-option[data-event="愛語攝"]:hover,
    .event-option[data-event="利行攝"]:hover,
    .event-option[data-event="同事攝"]:hover {
      transform: translateY(-4px) scale(1.02);
      filter: brightness(110%) contrast(105%);
    }

    /* 個別懸浮陰影效果 */
    .event-option[data-event="布施攝"]:hover {
      box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4),
                  0 4px 10px rgba(255, 165, 0, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    .event-option[data-event="愛語攝"]:hover {
      box-shadow: 0 8px 25px rgba(255, 105, 180, 0.4),
                  0 4px 10px rgba(255, 20, 147, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    .event-option[data-event="利行攝"]:hover {
      box-shadow: 0 8px 25px rgba(0, 250, 154, 0.4),
                  0 4px 10px rgba(0, 206, 209, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    .event-option[data-event="同事攝"]:hover {
      box-shadow: 0 8px 25px rgba(147, 112, 219, 0.4),
                  0 4px 10px rgba(138, 43, 226, 0.3),
                  inset 0 -3px 8px rgba(0, 0, 0, 0.1);
    }

    /* 懸浮時顯示內部光暈 */
    .event-option[data-event="布施攝"]:hover::after,
    .event-option[data-event="愛語攝"]:hover::after,
    .event-option[data-event="利行攝"]:hover::after,
    .event-option[data-event="同事攝"]:hover::after {
      opacity: 1;
    }

    /* 懸浮時顯示閃光效果 */
    .event-option[data-event="布施攝"]:hover::before,
    .event-option[data-event="愛語攝"]:hover::before,
    .event-option[data-event="利行攝"]:hover::before,
    .event-option[data-event="同事攝"]:hover::before {
      opacity: 1;
      left: 100%;
      transition: left 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* 點擊效果增強 */
    .event-option[data-event="布施攝"]:active,
    .event-option[data-event="愛語攝"]:active,
    .event-option[data-event="利行攝"]:active,
    .event-option[data-event="同事攝"]:active {
      transform: translateY(2px);
      filter: brightness(95%) contrast(105%);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2),
                  inset 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    /* 善緣按鈕 - 翡翠綠漸層 */
    .event-type-btn[data-type="good"] {
      background: linear-gradient(135deg, #48BB78, #38A169);
      color: white;
      border: none !important;
      box-shadow: 0 4px 12px rgba(72, 187, 120, 0.2);
    }

    /* 惡緣按鈕 - 深紅漸層 */
    .event-type-btn[data-type="bad"] {
      background: linear-gradient(135deg, #F56565, #E53E3E);
      color: white;
      border: none !important;
      box-shadow: 0 4px 12px rgba(245, 101, 101, 0.2);
    }

    /* 中道實相按鈕 - 寶藍漸層 */
    .event-type-btn[data-type="neutral"] {
      background: linear-gradient(135deg, #4299E1, #3182CE);
      color: white;
      border: none !important;
      box-shadow: 0 4px 12px rgba(66, 153, 225, 0.2);
    }

    /* 挑戰按鈕 - 紫金漸層 */
    .event-type-btn[data-type="challenge"] {
      background: linear-gradient(135deg, #9F7AEA, #805AD5);
      color: white;
      border: none !important;
      box-shadow: 0 4px 12px rgba(159, 122, 234, 0.2);
    }

    /* 共同的懸浮效果 */
    .event-type-btn {
      transition: all 0.3s ease;
      font-weight: 600;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .event-type-btn:hover {
      transform: translateY(-2px);
      filter: brightness(110%);
    }

    .event-type-btn:active {
      transform: translateY(0);
      filter: brightness(95%);
    }

    /* 選中狀態 */
    .event-type-btn.active {
      filter: brightness(105%);
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .pass-start-button {
      background: linear-gradient(135deg, #F6AD55, #ED8936);
      color: white;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      box-shadow: 0 4px 12px rgba(237, 137, 54, 0.2);
    }

    .pass-start-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(237, 137, 54, 0.3);
    }

    .pass-start-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(237, 137, 54, 0.2);
    }

    .custom-dialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .dialog-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      animation: fadeIn 0.2s ease-out;
    }

    .dialog-container {
      position: relative;
      width: 90%;
      max-width: 400px;
      margin: 1.5rem;
      animation: slideIn 0.3s ease-out;
    }

    .dialog-content {
      background: white;
      padding: 1.5rem;
      border-radius: 16px;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1),
                  0 10px 10px -5px rgba(0, 0, 0, 0.04);
      text-align: center;
    }

    .dialog-icon {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
      color: #4F46E5;
    }

    .dialog-message {
      color: #1F2937;
      font-size: 1.125rem;
      font-weight: 500;
      margin-bottom: 1.5rem;
      line-height: 1.5;
    }

    .dialog-buttons {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
    }

    .dialog-btn {
      flex: 1;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.2s ease;
      border: none;
      cursor: pointer;
    }

    .dialog-btn.yes {
      background: linear-gradient(135deg, #4F46E5, #4338CA);
      color: white;
      box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
    }

    .dialog-btn.no {
      background: linear-gradient(135deg, #EF4444, #DC2626);
      color: white;
      box-shadow: 0 4px 6px -1px rgba(239, 68, 68, 0.2);
    }

    .dialog-btn:hover {
      transform: translateY(-2px);
      filter: brightness(110%);
    }

    .dialog-btn:active {
      transform: translateY(0);
      filter: brightness(90%);
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .hidden {
      display: none !important;
    }

    /* 單按鈕模式的樣式 */
    .dialog-buttons.single-button {
      justify-content: center;
    }

    .dialog-buttons.single-button .dialog-btn {
      min-width: 120px;
      max-width: 200px;
    }

    /* 特殊事件視窗樣式 */
    .special-event-dialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .special-event-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 1.5rem;
      position: relative;
    }

    .icon-animation {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      animation: pulse 2s infinite;
    }

    .special-event-title {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 1rem;
      color: #2D3748;
    }

    .special-event-message {
      font-size: 1.125rem;
      color: #4A5568;
      margin-bottom: 1.5rem;
    }

    /* 經過起點的樣式 */
    .special-event-dialog.checkpoint .icon-animation {
      background: linear-gradient(135deg, #F6E05E, #ECC94B);
      box-shadow: 0 0 30px rgba(236, 201, 75, 0.5);
    }

    .special-event-dialog.checkpoint .special-event-title {
      color: #B7791F;
    }

    .special-event-dialog.checkpoint .dialog-btn.special {
      background: linear-gradient(135deg, #F6E05E, #D69E2E);
    }

    /* 獲得阿彌陀佛的樣式 */
    .special-event-dialog.amitabha .icon-animation {
      background: linear-gradient(135deg, #9F7AEA, #805AD5);
      box-shadow: 0 0 30px rgba(159, 122, 234, 0.5);
    }

    .special-event-dialog.amitabha .special-event-title {
      color: #6B46C1;
    }

    .special-event-dialog.amitabha .dialog-btn.special {
      background: linear-gradient(135deg, #9F7AEA, #6B46C1);
    }

    /* 動畫效果 */
    @keyframes pulse {
      0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 0, 0, 0.3);
      }
      70% {
        transform: scale(1);
        box-shadow: 0 0 0 15px rgba(0, 0, 0, 0);
      }
      100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
      }
    }

    @keyframes fadeInScale {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .dialog-content.special {
      animation: fadeInScale 0.3s ease-out;
      padding: 2rem;
    }

    .dialog-btn.special {
      color: white;
      padding: 0.875rem 2rem;
      font-weight: 600;
      min-width: 150px;
      border-radius: 12px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .dialog-btn.special:hover {
      transform: translateY(-2px);
      filter: brightness(110%);
    }

    .amitabha-get-dialog {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .amitabha-image-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 1.5rem;
      border-radius: 50%;
      overflow: hidden;
    }

    .amitabha-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      animation: glow 2s infinite;
    }

    .light-effect {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, 
        rgba(255, 223, 128, 0.3) 0%,
        rgba(255, 223, 128, 0) 70%);
      animation: rotate 10s linear infinite;
    }

    .dialog-content.amitabha {
      background: linear-gradient(135deg, #FEFCF1, #FFF9E5);
      padding: 2rem;
      max-width: 400px;
      text-align: center;
      animation: fadeInScale 0.5s ease-out;
    }

    .amitabha-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #B7791F;
      margin-bottom: 1rem;
      text-shadow: 0 2px 4px rgba(183, 121, 31, 0.2);
    }

    .amitabha-message {
      font-size: 1.25rem;
      color: #744210;
      margin-bottom: 1.5rem;
    }

    .dialog-btn.amitabha-btn {
      background: linear-gradient(135deg, #F6E05E, #D69E2E);
      color: white;
      padding: 0.875rem 2rem;
      font-weight: 600;
      min-width: 150px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(214, 158, 46, 0.3);
      transition: all 0.3s ease;
    }

    .dialog-btn.amitabha-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(214, 158, 46, 0.4);
    }

    @keyframes glow {
      0% {
        box-shadow: 0 0 20px rgba(255, 223, 128, 0.5);
      }
      50% {
        box-shadow: 0 0 40px rgba(255, 223, 128, 0.8);
      }
      100% {
        box-shadow: 0 0 20px rgba(255, 223, 128, 0.5);
      }
    }

    @keyframes rotate {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    .dialog-content.amitabha-special {
      background: linear-gradient(135deg, #FFF5E6, #FFECD1);
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
    }

    .buddha-image-container {
      position: relative;
      width: 180px;
      height: 180px;
      margin: 0 auto 1.5rem;
      border-radius: 50%;
      overflow: hidden;
    }

    .buddha-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
      animation: glow 2s infinite;
    }

    .light-rays {
      position: absolute;
      top: -50%;
      left: -50%;
      right: -50%;
      bottom: -50%;
      background: radial-gradient(circle at center,
        rgba(255, 223, 128, 0.4) 0%,
        rgba(255, 223, 128, 0) 70%);
      animation: rotate 10s linear infinite;
    }

    .amitabha-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #B7791F;
      margin-bottom: 1rem;
      text-shadow: 0 2px 4px rgba(183, 121, 31, 0.2);
    }

    .amitabha-message {
      font-size: 1.25rem;
      color: #744210;
      margin-bottom: 1.5rem;
    }

    .dialog-btn.amitabha-confirm {
      background: linear-gradient(135deg, #F6E05E, #D69E2E);
      color: white;
      padding: 0.875rem 2.5rem;
      font-size: 1.125rem;
      font-weight: 600;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(214, 158, 46, 0.3);
      transition: all 0.3s ease;
    }

    .dialog-btn.amitabha-confirm:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(214, 158, 46, 0.4);
    }

    /* 添加使用阿彌陀佛功德的按鈕樣式 */
    .dialog-buttons.amitabha-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      margin-top: 1.5rem;
    }

    .dialog-btn.amitabha-btn {
      padding: 0.875rem 1.5rem;
      font-size: 1.125rem;
      font-weight: 600;
      border-radius: 12px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .dialog-btn.amitabha-btn.yes {
      background: linear-gradient(135deg, #F6E05E, #D69E2E);
      color: white;
      box-shadow: 0 4px 12px rgba(214, 158, 46, 0.3);
    }

    .dialog-btn.amitabha-btn.no {
      background: linear-gradient(135deg, #CBD5E0, #A0AEC0);
      color: white;
      box-shadow: 0 4px 12px rgba(160, 174, 192, 0.3);
    }

    .dialog-btn.amitabha-btn:hover {
      transform: translateY(-2px);
    }

    .dialog-btn.amitabha-btn.yes:hover {
      box-shadow: 0 6px 15px rgba(214, 158, 46, 0.4);
    }

    .dialog-btn.amitabha-btn.no:hover {
      box-shadow: 0 6px 15px rgba(160, 174, 192, 0.4);
    }

    .dialog-content.challenge-special {
      background: linear-gradient(135deg, #F7FAFC, #EDF2F7);
      padding: 2rem;
      border-radius: 20px;
      text-align: center;
    }

    .challenge-image-container {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto 1.5rem;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .challenge-image {
      width: 100%;
      height: 120%;  /* 增加高度以便有更多空間可以調整 */
      object-fit: cover;
      transition: transform 0.3s ease;
      object-position: center 5%;  /* 調整圖片的垂直位置，數值越小越往上 */
    }

    .challenge-image-container:hover .challenge-image {
      transform: scale(1.05);
    }

    .challenge-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2D3748;
      margin-bottom: 1rem;
    }

    .challenge-message {
      font-size: 1.25rem;
      color: #4A5568;
      margin-bottom: 1.5rem;
    }

    .dialog-buttons.challenge-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
    }

    .dialog-btn.challenge-btn {
      padding: 0.875rem 1.5rem;
      font-size: 1.125rem;
      font-weight: 600;
      border-radius: 12px;
      transition: all 0.3s ease;
      min-width: 120px;
    }

    .dialog-btn.challenge-btn.yes {
      background: linear-gradient(135deg, #48BB78, #38A169);
      color: white;
      box-shadow: 0 4px 12px rgba(56, 161, 105, 0.3);
    }

    .dialog-btn.challenge-btn.no {
      background: linear-gradient(135deg, #F56565, #E53E3E);
      color: white;
      box-shadow: 0 4px 12px rgba(229, 62, 62, 0.3);
    }

    .dialog-btn.challenge-btn:hover {
      transform: translateY(-2px);
    }

    .dialog-btn.challenge-btn.yes:hover {
      box-shadow: 0 6px 15px rgba(56, 161, 105, 0.4);
    }

    .dialog-btn.challenge-btn.no:hover {
      box-shadow: 0 6px 15px rgba(229, 62, 62, 0.4);
    }

    .dialog-image-container {
      width: 200px;
      height: 200px;
      margin: 0 auto 1.5rem;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }

    .dialog-image {
      width: 100%;
      height: 120%;
      object-fit: cover;
      object-position: center 30%;
    }

    .input-confirmation {
      transition: all 0.3s ease;
      outline: none;
    }

    .input-confirmation:focus {
      box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.2);
    }

    /* 倒社按鈕樣式強化 */
    #collapseClub {
      background: linear-gradient(135deg, #F56565, #C53030);
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    #collapseClub:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(245, 101, 101, 0.4);
    }

    #collapseClub:active {
      transform: translateY(1px);
    }

    #collapseClub::before {
      content: '⚠️';
      margin-right: 8px;
    }

    .collapse-warning {
      text-align: center;
      padding: 1rem;
    }

    .warning-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      animation: shake 0.5s ease-in-out;
    }

    .warning-title {
      color: #E53E3E;
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }

    .warning-message {
      text-align: left;
      margin: 1rem 0;
    }

    .warning-message ul {
      margin: 0.5rem 0;
      padding-left: 1rem;
    }

    .warning-message li {
      color: #2D3748;
      margin: 0.5rem 0;
    }

    .warning-note {
      color: #E53E3E;
      font-weight: bold;
      margin-top: 1rem;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* 確認對話框按鈕樣式 */
    .dialog-btn.yes {
      background: linear-gradient(135deg, #F56565, #C53030);
      color: white;
      font-weight: bold;
    }

    .dialog-btn.no {
      background: linear-gradient(135deg, #A0AEC0, #718096);
      color: white;
    }
  </style>
</head>
<body class="p-4">
  <!-- 修改固定的狀態按鈕 -->
  <div class="status-button" id="statusButton">
    <div class="mini-stats">
      <div class="mini-stat-item">
        <span>社員:</span>
        <span id="miniMemberStatus">10</span>
      </div>
      <div class="mini-stat-item">
        <span>幹部:</span>
        <span id="miniOfficerStatus">5</span>
      </div>
      <div class="mini-stat-item amitabha-mini">
        <span>阿彌陀佛:</span>
        <span id="miniAmitabhaStatus">0</span>
      </div>
    </div>
  </div>

  <!-- 修改展開的狀態卡片 -->
  <div class="status-card" id="statusCard">
    <div class="status-grid">
      <div class="status-item">
        <div class="status-label">目前總社員數</div>
        <div class="status-value" id="memberStatus">10</div>
      </div>
      <div class="status-item">
        <div class="status-label">目前總幹部數</div>
        <div class="status-value" id="officerStatus">5</div>
      </div>
      <div class="status-item">
        <div class="status-label">當前期間劫難數</div>
        <div class="status-value" id="disasterStatus">0</div>
      </div>
      <div class="status-item">
        <div class="status-label">阿彌陀佛功德</div>
        <div class="status-value" id="amitabhaStatus">0</div>
      </div>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-6xl mx-auto mt-16">
    <div id="clubCard" class="card">
      <div class="card-header">
        <h2>佛學大富翁計分表</h2>
      </div>
      <div class="card-content">
        <div class="input-group">
          <label>事件名稱</label>
          <input type="text" id="eventName" readonly>
        </div>

        <div class="input-group">
          <label>選擇事件類型</label>
          <div class="event-type-buttons">
            <button class="event-type-btn" data-type="good">善緣</button>
            <button class="event-type-btn" data-type="bad">惡緣</button>
            <button class="event-type-btn" data-type="neutral">中道實相</button>
            <button class="event-type-btn" data-type="challenge">挑戰</button>
          </div>
        </div>

        <div class="input-group event-buttons hidden" id="goodEvents">
          <label>善緣事件</label>
          <div class="event-options">
            <button class="event-option" data-event="廣結善緣">廣結善緣</button>
            <button class="event-option" data-event="福報現前">福報現前</button>
            <button class="event-option" data-event="發長遠心">發長遠心</button>
            <button class="event-option" data-event="見性成佛">見性成佛</button>
            <button class="event-option" data-event="時來運轉">時來運轉</button>
            <button class="event-option special-event" data-event="阿彌陀佛">阿彌陀佛</button>
            <button class="event-option" data-event="布施攝">布施攝</button>
            <button class="event-option" data-event="愛語攝">愛語攝</button>
            <button class="event-option" data-event="利行攝">利行攝</button>
            <button class="event-option" data-event="同事攝">同事攝</button/>
          </div>
        </div>

        <div class="input-group event-buttons hidden" id="badEvents">
          <label>惡緣事件</label>
          <div class="event-options">
            <button class="event-option" data-event="境界來襲">境界來襲</button>
            <button class="event-option" data-event="惡緣纏身">惡緣纏身</button>
            <button class="event-option" data-event="迷失本心">迷失本心</button>
            <button class="event-option" data-event="流浪諸有">流浪諸有</button>
            <button class="event-option" data-event="怒目金剛">怒目金剛</button>
            <button class="event-option" data-event="惡業果熟">惡業果熟</button>
            <button class="event-option" data-event="悲心不足">悲心不足</button>
          </div>
        </div>

        <div class="input-group event-buttons hidden" id="neutralEvents">
          <label>中道實相事件</label>
          <div class="event-options">
            <button class="event-option" data-event="中道實相">中道實相</button>
            <button class="event-option" data-event="和而不同">和而不同</button>
            <button class="event-option" data-event="不偏不倚">不偏不倚</button>
            <button class="event-option" data-event="中庸之道">中庸之道</button>
            <button class="event-option" data-event="動容揚古路">動容揚古路</button>
            <button class="event-option" data-event="不墮悄然機">不墮悄然機</button>
          </div>
        </div>

        <div class="input-group event-buttons hidden" id="challengeEvents">
          <label>挑戰事件</label>
          <div class="event-options">
            <button class="event-option" data-event="阿修羅的挑戰">阿修羅的挑戰</button>
            <button class="event-option" data-event="夜叉的阻攔">夜叉的阻攔</button>
            <button class="event-option" data-event="阿羅漢的煩惱">阿羅漢的煩惱</button>
          </div>
        </div>

        <div class="input-group hidden" id="changeInputs">
          <div class="input-group">
            <label>社員變動數</label>
            <select id="memberChange">
              <option value="-10">-10</option>
              <option value="-9">-9</option>
              <option value="-8">-8</option>
              <option value="-7">-7</option>
              <option value="-6">-6</option>
              <option value="-5">-5</option>
              <option value="-4">-4</option>
              <option value="-3">-3</option>
              <option value="-2">-2</option>
              <option value="-1">-1</option>
              <option value="0" selected>0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>

          <div class="input-group">
            <label>幹部變動數</label>
            <select id="officerChange">
              <option value="-10">-10</option>
              <option value="-9">-9</option>
              <option value="-8">-8</option>
              <option value="-7">-7</option>
              <option value="-6">-6</option>
              <option value="-5">-5</option>
              <option value="-4">-4</option>
              <option value="-3">-3</option>
              <option value="-2">-2</option>
              <option value="-1">-1</option>
              <option value="0" selected>0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
              <option value="7">7</option>
              <option value="8">8</option>
              <option value="9">9</option>
              <option value="10">10</option>
            </select>
          </div>
        </div>

        <div class="button-container">
          <button id="submitEvent" class="submit-button">送出事件</button>
          <button id="passStart" class="pass-start-button">經過起點</button>
          <button id="collapseClub">倒社按鈕</button>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h3>事件歷史</h3>
      </div>
      <div class="card-content">
        <div id="eventHistory" class="max-h-[calc(100vh-400px)] overflow-y-auto pr-2"></div>
      </div>
    </div>
  </div>

  <div id="alertDialog">
    <div class="alert-content">
      <h4 class="text-2xl font-bold mb-4">社團已倒社</h4>
      <p class="text-gray-600 mb-6">請找關主撰寫懺悔小卡，再重新創社</p>
      <button id="resetClub">重新創社</button>
    </div>
  </div>

  <div id="customDialog" class="custom-dialog hidden">
    <div class="dialog-backdrop"></div>
    <div class="dialog-container">
      <div class="dialog-content">
        <div class="dialog-icon">
          <svg class="h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <p id="dialogMessage" class="dialog-message"></p>
        <div class="dialog-buttons">
          <button id="dialogNo" class="dialog-btn no">取消</button>
          <button id="dialogYes" class="dialog-btn yes">確定</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加特殊事件的動畫視窗 -->
  <div id="specialEventDialog" class="special-event-dialog hidden">
    <div class="dialog-backdrop"></div>
    <div class="dialog-container">
      <div class="dialog-content special">
        <div class="special-event-icon">
          <div class="icon-animation"></div>
        </div>
        <h2 id="specialEventTitle" class="special-event-title"></h2>
        <p id="specialEventMessage" class="special-event-message"></p>
        <div class="dialog-buttons">
          <button id="specialEventConfirm" class="dialog-btn special">確定</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加阿彌陀佛獲得專用對話框 -->
  <div id="amitabhaGetDialog" class="custom-dialog hidden">
    <div class="dialog-backdrop"></div>
    <div class="dialog-container">
      <div class="dialog-content amitabha-special">
        <div class="buddha-image-container">
          <img src="budda.jpg" alt="阿彌陀佛" class="buddha-image">
          <div class="light-rays"></div>
        </div>
        <h2 class="amitabha-title">南無阿彌陀佛！</h2>
        <p class="amitabha-message">獲得一次阿彌陀佛功德</p>
        <div class="dialog-buttons">
          <button id="amitabhaConfirm" class="dialog-btn amitabha-confirm">阿彌陀佛</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加使用阿彌陀佛功德對話框 -->
  <div id="amitabhaUseDialog" class="custom-dialog hidden">
    <div class="dialog-backdrop"></div>
    <div class="dialog-container">
      <div class="dialog-content amitabha-special">
        <div class="buddha-image-container">
          <img src="budda.jpg" alt="阿彌陀佛" class="buddha-image">
          <div class="light-rays"></div>
        </div>
        <h2 class="amitabha-title">南無阿彌陀佛！</h2>
        <p class="amitabha-message">是否使用阿彌陀佛功德？</p>
        <div class="dialog-buttons amitabha-buttons">
          <button id="amitabhaUseNo" class="dialog-btn amitabha-btn no">不使用</button>
          <button id="amitabhaUseYes" class="dialog-btn amitabha-btn yes">使用</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加挑戰對話框 -->
  <div id="challengeDialog" class="custom-dialog hidden">
    <div class="dialog-backdrop"></div>
    <div class="dialog-container">
      <div class="dialog-content challenge-special">
        <div class="challenge-image-container">
          <img src="annoy.jpg" alt="挑戰" class="challenge-image">
        </div>
        <h2 id="challengeTitle" class="challenge-title"></h2>
        <p id="challengeMessage" class="challenge-message">是否完成挑戰？</p>
        <div class="dialog-buttons challenge-buttons">
          <button id="challengeNo" class="dialog-btn challenge-btn no">挑戰失敗</button>
          <button id="challengeYes" class="dialog-btn challenge-btn yes">完成</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const INITIAL_MEMBERS = 10;
    const INITIAL_OFFICERS = 5;

    let memberChange = 0;
    let officerChange = 0;
    let disasters = 0;
    let eventName = '';
    let isCollapsed = false;
    let events = [
      {
        name: '創立社團',
        memberChange: INITIAL_MEMBERS,
        officerChange: INITIAL_OFFICERS,
        disasters: 0,
        timestamp: new Date().toLocaleString(),
        isReset: true
      }
    ];

    const collapseClubButton = document.getElementById('collapseClub');
    const resetClubButton = document.getElementById('resetClub');
    const alertDialog = document.getElementById('alertDialog');
    const statusButton = document.getElementById('statusButton');
    const statusCard = document.getElementById('statusCard');
    let isExpanded = false;
    const disastersSelect = document.getElementById("disasters");
    const eventNameInput = document.getElementById("eventName");

    let amitabhaCount = 0;
    let selectedEventType = null;

    // 事件類型按鈕點擊處理
    document.querySelectorAll('.event-type-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        selectedEventType = btn.dataset.type;
        hideAllEventButtons();
        document.querySelectorAll('.event-type-btn').forEach(b => {
          b.classList.remove('active');
        });
        btn.classList.add('active');
        document.getElementById(`${selectedEventType}Events`).classList.remove('hidden');
      });
    });

    // 修改事件按鈕點擊處理
    document.querySelectorAll('.event-option').forEach(btn => {
      btn.addEventListener('click', async () => {
        const eventName = btn.dataset.event;
        
        if (selectedEventType === 'bad') {
          if (amitabhaCount > 0) {
            const useAmitabha = await showAmitabhaUseDialog();
            if (useAmitabha) {
              amitabhaCount--;
              renderStats();
              handleAmitabhaUse(eventName);
              return;
            }
          }
        } else if (eventName === '阿彌陀佛') {
          handleAmitabhaGet();
          return;
        } else if (selectedEventType === 'challenge') {
          let useAmitabha = false;
          if (amitabhaCount > 0) {
            useAmitabha = await showAmitabhaUseDialog();
            if (useAmitabha) {
              amitabhaCount--;
              renderStats();
            }
          }

          const isSuccess = await showChallengeDialog(eventName);
          
          if (isSuccess) {
            const newEvent = {
              name: `成功完成「${eventName}」挑戰`,
              memberChange: 0,
              officerChange: 0,
              disasters: 1,
              timestamp: new Date().toLocaleString(),
              isChallenge: true,
              challengeResult: 'success'
            };
            events.push(newEvent);
            await showCustomDialog('恭喜完成挑戰！經歷劫難+1', '確定', null, 'success.jpg');
          } else {
            if (useAmitabha) {
              const newEvent = {
                name: `阿彌陀佛功德護佑，平安度過「${eventName}」挑戰失敗`,
                memberChange: 0,
                officerChange: 0,
                disasters: 0,
                timestamp: new Date().toLocaleString(),
                isChallenge: true,
                challengeResult: 'protected'
              };
              events.push(newEvent);
              await showCustomDialog('阿彌陀佛功德護佑，平安度過失敗！', '確定', null, 'budda.jpg');
            } else {
              const newEvent = {
                name: `失敗於「${eventName}」挑戰`,
                memberChange: -2,
                officerChange: 0,
                disasters: 0,
                timestamp: new Date().toLocaleString(),
                isChallenge: true,
                challengeResult: 'fail'
              };
              events.push(newEvent);
              await showCustomDialog('挑戰失敗！社員-2', '確定', null, 'fail.jpg');
            }
          }
          
          renderStats();
          renderEventHistory();
          return;
        }

        // 顯示變動選項並設置事件名稱
        document.getElementById('eventName').value = eventName;
        
        // 中道實相事件特殊處理
        if (selectedEventType === 'neutral') {
          document.getElementById('changeInputs').classList.add('hidden');
          document.getElementById('memberChange').value = '0';
          document.getElementById('officerChange').value = '0';
        } else {
          document.getElementById('changeInputs').classList.remove('hidden');
        }
        
        // 重置其他按鈕的背景色
        document.querySelectorAll('.event-option').forEach(b => {
          b.style.backgroundColor = '';
        });
        
        // 設置選中按鈕的背景色（除了特殊事件按鈕）
        if (!btn.classList.contains('special-event')) {
          btn.style.backgroundColor = 'rgba(66, 153, 225, 0.3)';
        }
      });
    });

    // 修改送出事件按鈕的處理函數
    document.addEventListener('DOMContentLoaded', () => {
      const submitButton = document.getElementById('submitEvent');
      if (submitButton) {
        submitButton.addEventListener('click', () => {
          const eventName = document.getElementById('eventName').value;
          if (!eventName) {
            alert('請選擇事件！');
            return;
          }

          let memberChange = 0;
          let officerChange = 0;

          // 如果不是中道實相事件，則獲取變動值
          if (selectedEventType !== 'neutral') {
            memberChange = parseInt(document.getElementById('memberChange').value) || 0;
            officerChange = parseInt(document.getElementById('officerChange').value) || 0;
          }

          // 創建新事件
          const newEvent = {
            name: eventName,
            memberChange: memberChange,
            officerChange: officerChange,
            disasters: 0,
            timestamp: new Date().toLocaleString(),
            isReset: false
          };

          // 添加事件到歷史記錄
          events.push(newEvent);

          // 檢查是否倒社
          const totals = calculateTotals();
          if (totals.totalMembers <= 0 || totals.totalOfficers <= 0) {
            setCollapsed(true);
            document.getElementById('alertDialog').style.display = 'flex';
          }

          // 重置表單
          document.getElementById('eventName').value = '';
          document.getElementById('memberChange').value = '0';
          document.getElementById('officerChange').value = '0';
          document.getElementById('changeInputs').classList.add('hidden');
          
          // 重置按鈕樣式
          document.querySelectorAll('.event-type-btn, .event-option').forEach(btn => {
            btn.style.backgroundColor = '';
            btn.classList.remove('active');
          });
          
          // 隱藏所有事件按鈕
          hideAllEventButtons();

          // 更新顯示
          renderStats();
          renderEventHistory();

          // 重置選擇狀態
          selectedEventType = null;
        });
      }
    });

    // 新增阿彌陀佛功德
    const addAmitabha = () => {
      if (selectedEventType === 'good') {
        amitabhaCount++;
        document.getElementById('amitabhaCount').textContent = amitabhaCount;
      }
    };

    const hideAllEventButtons = () => {
      document.querySelectorAll('.event-buttons').forEach(div => {
        div.classList.add('hidden');
      });
      document.getElementById('changeInputs').classList.add('hidden');
      
      // 重置所有按鈕的背景色
      document.querySelectorAll('.event-type-btn, .event-option').forEach(btn => {
        btn.style.backgroundColor = '';
      });
    };

    const showCustomDialog = (message, yesText = '確定', noText = null, imageSrc = null) => {
      return new Promise((resolve) => {
        const dialog = document.getElementById('customDialog');
        const messageEl = document.getElementById('dialogMessage');
        const buttonsContainer = dialog.querySelector('.dialog-buttons');
        const yesBtn = document.getElementById('dialogYes');
        const noBtn = document.getElementById('dialogNo');
        
        // 隱藏 icon
        const dialogIcon = dialog.querySelector('.dialog-icon');
        if (dialogIcon) {
          dialogIcon.style.display = imageSrc ? 'none' : 'flex';
        }
        
        // 處理圖片顯示
        let imageContainer = dialog.querySelector('.dialog-image-container');
        if (imageSrc) {
          if (!imageContainer) {
            imageContainer = document.createElement('div');
            imageContainer.className = 'dialog-image-container';
            const img = document.createElement('img');
            imageContainer.appendChild(img);
            dialog.querySelector('.dialog-content').insertBefore(imageContainer, messageEl);
          }
          const img = imageContainer.querySelector('img');
          img.src = imageSrc;
          img.className = 'dialog-image';
          imageContainer.style.display = 'block';
        } else if (imageContainer) {
          imageContainer.style.display = 'none';
        }
        
        messageEl.textContent = message;
        yesBtn.textContent = yesText;
        
        if (noText === null) {
          noBtn.style.display = 'none';
          buttonsContainer.classList.add('single-button');
        } else {
          noBtn.style.display = 'block';
          noBtn.textContent = noText;
          buttonsContainer.classList.remove('single-button');
        }
        
        dialog.classList.remove('hidden');

        yesBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(true);
        };

        noBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(false);
        };

        dialog.querySelector('.dialog-backdrop').onclick = (e) => {
          if (noText === null && e.target === dialog.querySelector('.dialog-backdrop')) {
            dialog.classList.add('hidden');
            resolve(true);
          }
        };
      });
    };

    const handleCollapseClub = async () => {
      // 簡單明確的確認對話框
      const confirmCollapse = await showCustomDialog(
        '確定要倒社嗎？此操作會清空所有社員和幹部。',
        '確定倒社',
        '取消',
        'warning.jpg'
      );

      if (!confirmCollapse) return;

      // 執行倒社操作
      setCollapsed(true);
      alertDialog.style.display = 'flex';

      // 記錄倒社事件
      const totals = calculateTotals();
      const collapseEvent = {
        name: '社團倒社',
        memberChange: -totals.totalMembers,
        officerChange: -totals.totalOfficers,
        disasters: 0,
        timestamp: new Date().toLocaleString(),
        isCollapse: true
      };
      events.push(collapseEvent);
      renderEventHistory();
    };

    const setCollapsed = (collapsed) => {
      isCollapsed = collapsed;
      const clubCard = document.getElementById('clubCard');
      clubCard.classList.toggle('collapsed', collapsed);
    };

    const resetClub = () => {
      const resetEvent = {
        name: '社團重建',
        memberChange: 5,
        officerChange: 3,
        disasters: 0,
        timestamp: new Date().toLocaleString(),
        isReset: true
      };

      events.push(resetEvent);
      setCollapsed(false);
      amitabhaCount = 0;
      updateAmitabhaDisplay();
      renderStats();
      renderEventHistory();
      alertDialog.style.display = 'none';
    };

    const calculateTotals = () => {
      let lastResetIndex = events.map(e => e.isReset).lastIndexOf(true);
      let relevantEvents = events.slice(lastResetIndex);
    
      return relevantEvents.reduce((acc, event) => ({
        totalMembers: acc.totalMembers + event.memberChange,
        totalOfficers: acc.totalOfficers + event.officerChange,
        totalDisasters: acc.totalDisasters + event.disasters
      }), {
        totalMembers: 0,
        totalOfficers: 0,
        totalDisasters: 0
      });
    };
   
    const renderStats = () => {
      const totals = calculateTotals();
      
      document.getElementById('memberStatus').textContent = totals.totalMembers;
      document.getElementById('officerStatus').textContent = totals.totalOfficers;
      document.getElementById('disasterStatus').textContent = totals.totalDisasters;
      document.getElementById('miniMemberStatus').textContent = totals.totalMembers;
      document.getElementById('miniOfficerStatus').textContent = totals.totalOfficers;
      
      // 更新阿彌陀佛顯示
      updateAmitabhaDisplay();

      // 添加動畫效果
      document.querySelectorAll('.status-value, .mini-stat-item span:last-child').forEach(el => {
        el.classList.remove('animated-number');
        void el.offsetWidth;
        el.classList.add('animated-number');
      });
    };

     const renderEventHistory = () => {
      const eventHistoryContainer = document.getElementById('eventHistory');
      eventHistoryContainer.innerHTML = events.map(event => {
        let eventHtml = `
          <div class="${getEventClass(event)} p-4 rounded-lg mb-4 border-l-4 ${getEventBorderColor(event)}">
            <p class="text-lg font-semibold text-gray-800">${event.name}</p>
            <p class="text-sm text-gray-600">時間：${event.timestamp}</p>
        `;

        if (event.isAmitabha) {
          eventHtml += `
            <p class="text-amber-600 font-medium">
              阿彌陀佛功德 ${event.amitabhaChange > 0 ? '+' : ''}${event.amitabhaChange}
            </p>
          `;
        } else if (event.isChallenge) {
          eventHtml += `
            <p class="text-indigo-600 font-medium">
              ${event.challengeResult === 'success' ? '經歷劫難 +1' : 
                event.challengeResult === 'protected' ? '阿彌陀佛護佑' : 
                '社員 -2'}
            </p>
          `;
        } else {
          eventHtml += `
            <p>社員變動：${event.memberChange}</p>
            <p>幹部變動：${event.officerChange}</p>
          `;
        }

        eventHtml += `</div>`;
        return eventHtml;
      }).join('');
    };

    // 添加事件邊框顏色輔助函數
    const getEventBorderColor = (event) => {
      if (event.isAmitabha) {
        return event.amitabhaChange > 0 ? 
          'border-amber-400' :  // 獲得阿彌陀佛功德
          'border-amber-600';   // 使用阿彌陀佛功德
      }
      if (event.isChallenge) {
        return event.challengeResult === 'success' ? 'border-indigo-500' :
               event.challengeResult === 'protected' ? 'border-amber-500' :
               'border-red-500';
      }
      if (event.memberChange > 0 || event.officerChange > 0) {
        return 'border-green-500';  // 正向變動
      }
      if (event.memberChange < 0 || event.officerChange < 0) {
        return 'border-red-500';    // 負向變動
      }
      if (event.isPassStart) {
        return 'border-orange-500';  // 經過起點的邊框顏色
      }
      return 'border-blue-500';     // 中性變動（中道實相）
    };

    // 新增事件樣式輔助函數
    const getEventClass = (event) => {
      if (event.isAmitabha) {
        return 'bg-yellow-50';
      }
      if (event.isChallenge) {
        return event.challengeResult === 'success' ? 'bg-indigo-50' :
               event.challengeResult === 'protected' ? 'bg-amber-50' :
               'bg-red-50';
      }
      if (event.isPassStart) {
        return 'bg-orange-50';  // 經過起點的背景顏色
      }
      return '';
    };

    collapseClubButton.addEventListener('click', handleCollapseClub);
    resetClubButton.addEventListener('click', resetClub);
    // 確保在 DOMContentLoaded 事件中綁定送出按鈕事件
    document.addEventListener('DOMContentLoaded', () => {
      // ... existing DOMContentLoaded code ...

      // 修改狀態按鈕點擊事件
      const statusButton = document.getElementById('statusButton');
      const statusCard = document.getElementById('statusCard');

      statusButton.addEventListener('click', (e) => {
        e.stopPropagation(); // 防止事件冒泡
        isExpanded = !isExpanded;
        statusCard.classList.toggle('expanded', isExpanded);
      });

      // 點擊其他地方時收起狀態卡片
      document.addEventListener('click', (event) => {
        if (!statusButton.contains(event.target) && 
            !statusCard.contains(event.target) && 
            isExpanded) {
          isExpanded = false;
          statusCard.classList.remove('expanded');
        }
      });

      // 防止狀態卡片的點擊事件冒泡
      statusCard.addEventListener('click', (e) => {
        e.stopPropagation();
      });
    });

    // 修改獲得阿彌陀佛功德的處理
    async function handleAmitabhaGet() {
      amitabhaCount++;
      renderStats(); // 立即更新數量
      await showAmitabhaGetDialog();
    }

    // 顯示獲得阿彌陀佛功德對話框
    function showAmitabhaGetDialog() {
      return new Promise((resolve) => {
        const dialog = document.getElementById('amitabhaGetDialog');
        const confirmBtn = document.getElementById('amitabhaConfirm');
        
        dialog.classList.remove('hidden');

        confirmBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(true);
        };
      });
    }

    // 顯示使用阿彌陀佛功德對話框
    function showAmitabhaUseDialog() {
      return new Promise((resolve) => {
        const dialog = document.getElementById('amitabhaUseDialog');
        const yesBtn = document.getElementById('amitabhaUseYes');
        const noBtn = document.getElementById('amitabhaUseNo');
        
        dialog.classList.remove('hidden');

        yesBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(true);
        };

        noBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(false);
        };
      });
    }

    // 修改使用阿彌陀佛功德的處理
    async function handleAmitabhaUse(eventName) {
      // 顯示使用成功的訊息
      await showCustomDialog(
        '阿彌陀佛功德護佑，平安度過！',
        '阿彌陀佛'
      );
      return true;
    }

    // 更新阿彌陀佛顯示的函數
    function updateAmitabhaDisplay() {
      document.getElementById('miniAmitabhaStatus').textContent = amitabhaCount;
      document.getElementById('amitabhaStatus').textContent = amitabhaCount;
      
      // 添加動畫效果
      document.querySelectorAll('#miniAmitabhaStatus, #amitabhaStatus').forEach(el => {
        el.classList.remove('animated-number');
        void el.offsetWidth; // 觸發重排
        el.classList.add('animated-number');
      });
    }

    // 添加經過起點按鈕的處理函數
    document.getElementById('passStart').addEventListener('click', async () => {
      const newEvent = {
        name: '經過起點',
        memberChange: 2,
        officerChange: 0,
        disasters: 0,
        timestamp: new Date().toLocaleString(),
        isReset: false,
        isPassStart: true
      };

      events.push(newEvent);
      await showSpecialEventDialog(
        'checkpoint',
        '經過起點！',
        '恭喜獲得社員 +2'
      );
      
      renderStats();
      renderEventHistory();
    });

    // 特殊事件視窗函數
    function showSpecialEventDialog(type, title, message) {
      return new Promise((resolve) => {
        const dialog = document.getElementById('specialEventDialog');
        const titleEl = document.getElementById('specialEventTitle');
        const messageEl = document.getElementById('specialEventMessage');
        const confirmBtn = document.getElementById('specialEventConfirm');
        
        dialog.className = `special-event-dialog ${type}`;
        titleEl.textContent = title;
        messageEl.textContent = message;
        
        dialog.classList.remove('hidden');

        confirmBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(true);
        };
      });
    }

    // 顯示挑戰對話框
    function showChallengeDialog(challengeName) {
      return new Promise((resolve) => {
        const dialog = document.getElementById('challengeDialog');
        const titleEl = document.getElementById('challengeTitle');
        const yesBtn = document.getElementById('challengeYes');
        const noBtn = document.getElementById('challengeNo');
        
        titleEl.textContent = `「${challengeName}」`;
        // 初始顯示 annoy.jpg
        document.querySelector('.challenge-image').src = 'annoy.jpg';
        dialog.classList.remove('hidden');

        yesBtn.onclick = () => {
          // 點擊成功時更換圖片
          document.querySelector('.challenge-image').src = 'success.jpg';
          dialog.classList.add('hidden');
          resolve(true);
        };

        noBtn.onclick = () => {
          dialog.classList.add('hidden');
          resolve(false);
        };
      });
    }

    // 添加輸入對話框函數
    function showInputDialog(message, confirmText, cancelText, expectedInput) {
      return new Promise((resolve) => {
        const dialog = document.createElement('div');
        dialog.className = 'custom-dialog';
        dialog.innerHTML = `
          <div class="dialog-backdrop"></div>
          <div class="dialog-container">
            <div class="dialog-content">
              <p class="dialog-message mb-4">${message}</p>
              <input type="text" 
                     class="input-confirmation mb-4 w-full px-3 py-2 border rounded-lg" 
                     placeholder="請輸入確認文字">
              <div class="dialog-buttons">
                ${cancelText ? `<button class="dialog-btn no">${cancelText}</button>` : ''}
                <button class="dialog-btn yes" disabled>${confirmText}</button>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(dialog);

        const input = dialog.querySelector('.input-confirmation');
        const confirmButton = dialog.querySelector('.dialog-btn.yes');
        const cancelButton = dialog.querySelector('.dialog-btn.no');

        // 即時驗證輸入
        input.addEventListener('input', (e) => {
          confirmButton.disabled = e.target.value !== expectedInput;
          
          // 添加視覺反饋
          if (e.target.value.length > 0) {
            if (e.target.value === expectedInput) {
              input.style.borderColor = '#48BB78';  // 綠色
              input.style.backgroundColor = '#F0FFF4';
            } else {
              input.style.borderColor = '#F56565';  // 紅色
              input.style.backgroundColor = '#FFF5F5';
            }
          } else {
            input.style.borderColor = '#E2E8F0';  // 預設邊框色
            input.style.backgroundColor = '#FFFFFF';
          }
        });

        confirmButton.addEventListener('click', () => {
          const value = input.value;
          document.body.removeChild(dialog);
          resolve(value);
        });

        if (cancelButton) {
          cancelButton.addEventListener('click', () => {
            document.body.removeChild(dialog);
            resolve(null);
          });
        }
      });
    }
  </script>
</body>
</html>
